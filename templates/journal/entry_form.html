{% extends 'base.html' %}

{% block title %}{% if entry %}Edit{% else %}New{% endif %} â€” Pure Herb{% endblock %}

{% block content %}
<div class="section">
  <div class="entry-card entry-card--form">
    <div class="section-label">{% if entry %}Edit{% else %}New{% endif %} Record</div>

    <form method="post" novalidate class="form-layout-grid">
      {% csrf_token %}

      <div class="form-group">
        <label for="{{ form.date.id_for_label }}" class="form-field__label">Date</label>
        <div class="form-field__input-wrap date-input-wrap">
          <span class="form-field__icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
          </span>
          <input type="text" name="{{ form.date.name }}" id="{{ form.date.id_for_label }}" value="{{ form.date.value|default:'' }}" required class="form-field__input date-input flatpickr-date" placeholder="Select date" autocomplete="off">
        </div>
        {% if form.date.errors %}
        <ul class="form-errors">
          {% for error in form.date.errors %}
          <li>{{ error }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.reference.id_for_label }}">Reference</label>
        <div class="input-wrap">
          <input type="text" name="{{ form.reference.name }}" id="{{ form.reference.id_for_label }}" value="{{ form.reference.value|default:'' }}" placeholder="e.g. INV-001">
        </div>
        {% if form.reference.errors %}
        <ul class="form-errors">
          {% for error in form.reference.errors %}
          <li>{{ error }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>

      <div class="form-group form-group--full">
        <label for="{{ form.description.id_for_label }}">Description</label>
        <textarea name="{{ form.description.name }}" id="{{ form.description.id_for_label }}" placeholder="Entry description..." required>{{ form.description.value|default:'' }}</textarea>
        {% if form.description.errors %}
        <ul class="form-errors">
          {% for error in form.description.errors %}
          <li>{{ error }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>

      <div class="form-group form-group--full">
        <label>Entry Lines (Debits must equal Credits)</label>
        {{ line_formset.management_form }}
        <div class="formset-lines">
          {% for form in line_formset %}
          <div class="formset-line {% if form.errors %}has-errors{% endif %}">
            {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
            <div class="formset-line-fields">
              <input type="text" name="{{ form.account.html_name }}" value="{{ form.account.value|default:'' }}" placeholder="Account" class="form-control">
              <input type="number" name="{{ form.debit.html_name }}" value="{{ form.debit.value|default:'' }}" placeholder="Debit" step="0.01" min="0" class="form-control" inputmode="decimal">
              <input type="number" name="{{ form.credit.html_name }}" value="{{ form.credit.value|default:'' }}" placeholder="Credit" step="0.01" min="0" class="form-control" inputmode="decimal">
              <input type="text" name="{{ form.memo.html_name }}" value="{{ form.memo.value|default:'' }}" placeholder="Memo" class="form-control">
              {% if line_formset.can_delete %}
              <label class="delete-checkbox">
                {{ form.DELETE }} Delete
              </label>
              {% endif %}
            </div>
            {% if form.errors %}
            <ul class="form-errors">
              {% for field in form %}
                {% for error in field.errors %}
                <li>{{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in form.non_field_errors %}
              <li>{{ error }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        {% if line_formset.non_form_errors %}
        <ul class="form-errors">
          {% for error in line_formset.non_form_errors %}
          <li>{{ error }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>

      <div class="actions">
        <a href="{% url 'journal:entry_list' %}" class="btn btn-secondary">Cancel</a>
        <button type="submit" class="btn btn-primary">{% if entry %}Update{% else %}Create{% endif %}</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
