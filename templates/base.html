{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Pure Herb — Journal{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=9">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css">
</head>

<body>
  <div class="page">
    <!-- Decorative organic blobs -->
    <div class="blobs" aria-hidden="true">
      <svg class="blob blob--tl" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor"
          d="M45.2,-68.7C58.5,-60.2,68.3,-45.5,73.5,-29.2C78.7,-12.9,79.3,5,74.2,20.7C69.1,36.4,58.3,49.9,44.6,58.8C30.9,67.7,14.4,72,-1.2,73.5C-16.8,75,-33.6,73.7,-47.2,66.4C-60.8,59.1,-71.2,45.8,-75.6,30.9C-80,16,-78.4,-0.5,-72.2,-14.8C-66,-29.1,-55.2,-41.2,-42.5,-50C-29.8,-58.8,-15.2,-64.3,0.8,-65.3C16.8,-66.3,31.9,-62.8,45.2,-68.7Z"
          transform="translate(100 100)" />
      </svg>
      <svg class="blob blob--br" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor"
          d="M38.9,-58.2C51.2,-50.8,62.1,-40.2,68.5,-27.4C74.9,-14.6,76.8,0.4,72.9,13.6C69,26.8,59.3,38.2,47.2,46.4C35.1,54.6,20.6,59.6,5.8,61.2C-9,62.8,-24.2,60.9,-37.4,54.8C-50.6,48.7,-61.8,38.4,-68.2,25.9C-74.6,13.4,-76.2,-1.3,-71.8,-14.4C-67.4,-27.5,-57,-39,-44.8,-47.2C-32.6,-55.4,-18.6,-60.3,-4.4,-58.8C9.8,-57.3,26.6,-49.4,38.9,-58.2Z"
          transform="translate(100 100)" />
      </svg>
      <svg class="blob blob--tr" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor"
          d="M52.3,-72.4C66.9,-63.2,76.4,-45.6,79.2,-26.8C82,-8,78.1,12,68.5,28.5C58.9,45,43.6,58,26.3,65.8C9,73.6,-10.3,76.2,-27.4,70.2C-44.5,64.2,-59.4,49.6,-68.2,32.4C-77,15.2,-79.7,-4.6,-74.4,-22.4C-69.1,-40.2,-55.8,-56,-39.8,-65.5C-23.8,-75,-5.2,-78.2,11.2,-75.8C27.6,-73.4,37.7,-65.4,52.3,-72.4Z"
          transform="translate(100 100)" />
      </svg>
    </div>

    <!-- Artistic Watermark -->
    <div class="watermark" aria-hidden="true">
      <img src="{% static 'img/logo.png' %}" alt="" />
    </div>

    <div class="app">
      <header class="header">
        <a href="{% url 'journal:home' %}" class="header-brand">
          <div class="logo-wrapper">
            <img src="{% static 'img/logo.png' %}" alt="Pure Herb" class="logo-img"
              onerror="this.style.display='none';this.nextElementSibling.style.display='inline-block';">
            <span class="logo-fallback" style="display:none">Pure Herb</span>
          </div>
        </a>
        <nav class="header-auth">
          {% if user.is_authenticated %}
            <span class="header-user">{{ user.username }}</span>
            <a href="{% url 'logout' %}" class="btn btn-ghost btn--sm">Log out</a>
          {% else %}
            <a href="{% url 'login' %}" class="btn btn-primary btn--sm">Log in</a>
          {% endif %}
        </nav>
      </header>

      <div class="app-body">
        {% if user.is_authenticated %}
        <aside class="sidebar" id="sidebar">
          <button type="button" class="sidebar-toggle" id="sidebar-toggle" aria-label="Collapse sidebar" title="Collapse sidebar">
            <span class="sidebar-toggle-icon" aria-hidden="true">‹</span>
          </button>
          <nav class="sidebar-nav">
            <a href="{% url 'journal:entry_list' %}" class="sidebar-link">
              <span class="sidebar-icon sidebar-icon--records" aria-hidden="true">≡</span>
              <span class="sidebar-label">View records</span>
            </a>
            {% if show_approval_queue %}
            <a href="{% url 'journal:approval_queue' %}" class="sidebar-link">
              <span class="sidebar-icon sidebar-icon--approval" aria-hidden="true">○</span>
              <span class="sidebar-label">Approval queue{% if sidebar_approval_count %}<span class="badge">{{ sidebar_approval_count }}</span>{% endif %}</span>
            </a>
            <a href="{% url 'journal:user_request_create' %}" class="sidebar-link">
              <span class="sidebar-icon sidebar-icon--request" aria-hidden="true">+</span>
              <span class="sidebar-label">Request new user</span>
            </a>
            {% endif %}
            {% if show_user_approval %}
            <a href="{% url 'journal:user_request_approval' %}" class="sidebar-link">
              <span class="sidebar-icon sidebar-icon--users" aria-hidden="true">◉</span>
              <span class="sidebar-label">User requests{% if sidebar_user_requests_count %}<span class="badge">{{ sidebar_user_requests_count }}</span>{% endif %}</span>
            </a>
            {% endif %}
            {% if show_user_management %}
            <a href="{% url 'journal:user_management' %}" class="sidebar-link">
              <span class="sidebar-icon sidebar-icon--management" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="1em" height="1em">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.6V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
              </span>
              <span class="sidebar-label">User Management</span>
            </a>
            {% endif %}
          </nav>
        </aside>
        <script>
        (function() {
          var sidebar = document.getElementById('sidebar');
          var toggle = document.getElementById('sidebar-toggle');
          if (!sidebar || !toggle) return;
          var STORAGE_KEY = 'sidebar-collapsed';
          function isCollapsed() { return sidebar.classList.contains('sidebar--collapsed'); }
          function setCollapsed(collapsed) {
            sidebar.classList.toggle('sidebar--collapsed', collapsed);
            toggle.setAttribute('aria-label', collapsed ? 'Expand sidebar' : 'Collapse sidebar');
            toggle.setAttribute('title', collapsed ? 'Expand sidebar' : 'Collapse sidebar');
            toggle.querySelector('.sidebar-toggle-icon').textContent = collapsed ? '›' : '‹';
            try { localStorage.setItem(STORAGE_KEY, collapsed ? '1' : '0'); } catch (e) {}
          }
          try {
            var stored = localStorage.getItem(STORAGE_KEY);
            if (stored === '1') setCollapsed(true);
          } catch (e) {}
          toggle.addEventListener('click', function() { setCollapsed(!isCollapsed()); });
        })();
        </script>
        {% endif %}
        <main class="main-content">
        {% if messages %}
        <ul class="messages">
          {% for message in messages %}
          <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% block content %}{% endblock %}
        </main>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
  <script src="{% static 'js/flatpickr-init.js' %}"></script>
</body>

</html>
